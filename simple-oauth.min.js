(function(t,e){"function"==typeof define&&define.amd?define(["underscore"],e):t.Backbone.Fiber=e(t._)})(this,function(t){function e(t){for(var e,t=t||16,r="",n=0,i=s.length;t>n;n++)e=Math.floor(Math.random()*i),r+=s.substring(e,e+1);return r}function r(){var t=new Date;return""+Math.floor(t.getTime()/1e3)}function n(t,e,r,n){function i(t,e,r,n){return 20>t?e&r|~e&n:40>t?e^r^n:60>t?e&r|e&n|r&n:e^r^n}function s(t){return 20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514}function o(t,e){var r=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(r>>16);return n<<16|65535&r}function a(t,e){return t<<e|t>>>32-e}function u(t,e){t[e>>5]|=128<<24-e%32,t[(e+64>>9<<4)+15]=e;for(var r=[80],n=1732584193,u=-271733879,h=-1732584194,c=271733878,p=-1009589776,f=0;t.length>f;f+=16){for(var m=n,l=u,d=h,_=c,g=p,v=0;80>v;v++){r[v]=16>v?t[f+v]:a(r[v-3]^r[v-8]^r[v-14]^r[v-16],1);var y=o(o(a(n,5),i(v,u,h,c)),o(o(p,r[v]),s(v)));p=c,c=h,h=a(u,30),u=n,n=y}n=o(n,m),u=o(u,l),h=o(h,d),c=o(c,_),p=o(p,g)}return[n,u,h,c,p]}function h(t){for(var e=[],r=(1<<n)-1,i=0;t.length*n>i;i+=n)e[i>>5]|=(t.charCodeAt(i/8)&r)<<32-n-i%32;return e}function c(t,e){var r=h(t);r.length>16&&(r=u(r,t.length*n));for(var i=[16],s=[16],o=0;16>o;o++)i[o]=909522486^r[o],s[o]=1549556828^r[o];var a=u(i.concat(h(e)),512+e.length*n);return u(s.concat(a),672)}function p(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=0;4*t.length>i;i+=3)for(var s=(255&t[i>>2]>>8*(3-i%4))<<16|(255&t[i+1>>2]>>8*(3-(i+1)%4))<<8|255&t[i+2>>2]>>8*(3-(i+2)%4),o=0;4>o;o++)n+=8*i+6*o>32*t.length?r:e.charAt(63&s>>6*(3-o));return n}function f(t,e){return p(c(t,e))}return r||(r="="),n||(n=8),f(t,e)}var i=["callback","consumer_key","nonce","signature_method","timestamp","token","verifier","version"],s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";SimpleOAuth={};var o=function(e,r,n,i){var i=i||{};this.method=e.toUpperCase(),this.uri=URI.parseUri(r),this.uri.fragment="",this.uri.normalize(),this.params=n,this.options=t.extend(o.default_options(),i)};o.default_options=function(){return{nonce:e(),signature_method:"HMAC-SHA1",timestamp:r(),version:"1.0"}},o.escape=function(t){return encodeURIComponent(t).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},o.unescape=function(t){return decodeURIComponent(t)},t.extend(o.prototype,{url:function(){var e=t.clone(this.uri);return e.query=null,e.build()},build:function(t){var e,t=t||"header";return"header"==t?e="OAuth "+this.normalized_header_attributes():"query"==t&&(e=this.normalized_query_attributes()),e},signed_attributes:function(){var e=t.clone(this.attributes());return e.oauth_signature=this.signature(),e},normalized_header_attributes:function(){return t.map(t.sortBy(t.pairs(this.signed_attributes()),function(t){return t[0]}),function(t){return t[0]+'="'+o.escape(t[1])+'"'}).join(", ")},normalized_query_attributes:function(){return t.map(t.sortBy(t.pairs(this.signed_attributes()),function(t){return t[0]}),function(t){return t[0]+"="+o.escape(t[1])}).join("&")},attributes:function(){var e={},r=this.options;return t.each(i,function(t){r[t]&&(e["oauth_"+t]=r[t])}),e},signature:function(){return this.hmac_sha1_signature()},hmac_sha1_signature:function(){return n(this.secret(),this.signature_base())},secret:function(){var e=t.pick(this.options,"consumer_secret","token_secret");return e.consumer_secret=e.consumer_secret||"",e.token_secret=e.token_secret||"",t.map(e,function(t){return o.escape(t)}).join("&")},signature_base:function(){return t.map([this.method,this.url(),this.normalized_params()],function(t){return o.escape(t)}).join("&")},normalized_params:function(){return t.map(t.map(this.signature_params(),function(e){return t.map(e,function(t){return o.escape(t)})}).sort(),function(t){return t.join("=")}).join("&")},signature_params:function(){return t.pairs(this.attributes()).concat(t.pairs(this.params),this.url_params())},url_params:function(){var e=[];return t.each(URI.parseQuery(this.uri.query||""),function(r,n){e.push(t(t.flatten([r]).sort()).chain().map(function(t){return[n,t]}).value())}),t.flatten(e,!0)}}),SimpleOAuth.Header=o;var a=function(e){switch(t.extend(this,e),this.default_port="",this.scheme){case"http":this.default_port="80";break;case"https":this.default_port="443"}};return t.extend(a.prototype,{normalize:function(){this.path&&""==this.path&&(this.path="/"),this.scheme&&this.scheme!=this.scheme.toLowerCase()&&(this.scheme=this.scheme.toLowerCase()),this.host&&this.host!=this.host.toLowerCase()&&(this.host=this.host.toLowerCase())},build:function(){var t="";return this.scheme&&(t+=this.scheme,t+=":"),this.opaque?t+=this.opaque:(this.host&&(t+="//"),this.userinfo&&(t+=this.userinfo,t+="@"),this.host&&(t+=this.host),this.port&&this.port!=this.default_port&&(t+=":",t+=this.port),t+=this.path,this.query&&(t+="?",t+=this.query)),this.fragment&&(t+="#",t+=this.fragment),t}}),URI={parseQuery:function(e){var r,n=(e||"").split("&"),i={};for(r=n.shift();r;r=n.shift()){var s=r.split("="),o="";s[1]&&(o=decodeURIComponent(s[1])),i[s[0]]?i[s[0]]instanceof Array?t.isArray(i[s[0]])?i[s[0]].push(o):i[s[0]]=[i[s[0]],o]:i[s[0]]=[i[s[0]],o]:i[s[0]]=o}return i},queryString:function(e){return t.map(e,function(t,e){return e+"="+encodeURIComponent(t)}).join("&")},parseUri:function(t){for(var e=URI.options,r=e.parser[e.strictMode?"strict":"loose"].exec(t),n={},i=14;i--;)n[e.key[i]]=r[i]||"";return n[e.q.name]={},n[e.key[12]].replace(e.q.parser,function(t,r,i){r&&(n[e.q.name][r]=i)}),new a(n)},options:{strictMode:!0,key:["source","scheme","authority","userinfo","user","password","host","port","relative","path","directory","file","query","fragment"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},SimpleOAuth});